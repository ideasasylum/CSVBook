// Generated by CoffeeScript 1.8.0
(function() {
  jQuery(function() {
    var current_page, get_row, next, next_page, page_exists, previous, previous_page, render_page, setup;
    $('#csvfile').on('change', function() {
      console.log('csv file changed');
      return $('#csvfile').parse({
        config: {
          header: true,
          skipEmptyLines: true,
          complete: function(results) {
            console.log(results);
            return setup(results);
          }
        }
      });
    });
    $('#previous').on('click', function() {
      return previous();
    });
    $('#next').on('click', function() {
      return next();
    });
    $(document).on('keydown', function(event) {
      if (event.keyCode === 37) {
        return previous();
      } else if (event.keyCode === 39) {
        return next();
      }
    });
    setup = function(results) {
      window.csvbook.results = results;
      window.csvbook.current_page = 0;
      return render_page();
    };
    render_page = function() {
      var data, fields, page;
      data = get_row(current_page());
      fields = _.map(data, function(value, key) {
        return {
          key: key,
          value: value
        };
      });
      page = window.csvbook.page_template(data);
      return $('#csvbook').html(page);
    };
    previous = function() {
      if (page_exists(previous_page())) {
        window.csvbook.current_page = previous_page();
        return render_page();
      }
    };
    next = function() {
      if (page_exists(next_page())) {
        window.csvbook.current_page = next_page();
        return render_page();
      }
    };
    get_row = function(row) {
      return window.csvbook.results.data[row];
    };
    current_page = function() {
      return window.csvbook.current_page;
    };
    next_page = function() {
      return current_page() + 1;
    };
    previous_page = function() {
      return current_page() - 1;
    };
    page_exists = function(page) {
      return page >= 0 && page < window.csvbook.results.data.length;
    };
    Handlebars.registerHelper('simple_format', function(text, options) {
      text = text.replace(/\r\n?/, "\n");
      text = $.trim(text);
      if (text.length > 0) {
        text = text.replace(/\n\n+/g, '</p><p>');
        text = text.replace(/\n/g, '<br />');
        text = '<p>' + text + '</p>';
      }
      return new Handlebars.SafeString(text);
    });
    window.csvbook = {};
    window.csvbook.render_page = render_page;
    window.csvbook.template_source = $("#page-template").html();
    return window.csvbook.page_template = Handlebars.compile(window.csvbook.template_source);
  });

}).call(this);


//# sourceMappingURL=csvbook.min.js.map
